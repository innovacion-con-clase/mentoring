<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La fe que se arremanga - Invitación Digital</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        /* Fuentes Personalizadas */
        :root {
            font-family: 'Inter', sans-serif;
        }

        h1,
        h2,
        h3,
        .font-title {
            font-family: 'Montserrat', sans-serif;
        }

        /* Clase para evitar scroll en el body cuando un modal está abierto */
        .modal-open {
            overflow: hidden;
        }

        /* Animaciones suaves */
        @keyframes radar-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(56, 189, 248, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(56, 189, 248, 0);
            }
        }

        .radar-effect {
            animation: radar-pulse 2s infinite;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
    <script>
        // Configuración y variables globales
        const SHEET_ENDPOINT = "https://script.google.com/macros/s/AKfycbyonuNONVfbmiwAUI0_koTsWABOSJ7iIFZp1dnLYDSKEPlmOJeA09h3BDlF0WhW7paE/exec";
        // ENLACE DE LA GUÍA (Pendiente actualizar si es necesario)
        const GUIDE_URL = "https://innovacion-con-clase.github.io/el-radar-del-cielo/";
        const MEET_URL = "https://meet.google.com/rsj-mbap-jpi";

        // Estado central
        let state = {
            openCover: false,
            openGuide: false,
            openRSVP: false,
            rsvpName: "",
            rsvpEmail: "",
            rsvpSent: false,
            sending: false,
            joinModalOpen: false,
            rsvpServerResponse: null,
            lastError: null,
            messageModal: null,
            // FECHA ACTUALIZADA: 2 de enero de 2026, 3:00 PM
            eventDate: new Date("2026-01-02T15:00:00-05:00"),
            now: new Date(),
        };

        // Función para actualizar y renderizar
        function updateState(newState) {
            state = { ...state, ...newState };
            render();
            const open = state.openGuide || state.openRSVP || state.joinModalOpen || state.messageModal;
            document.body.classList.toggle('modal-open', open);
        }

        // --- Lógica del Reloj ---
        function calculateCountdown() {
            const timeDiff = state.eventDate - state.now;
            const canJoin = timeDiff <= 5 * 60 * 1000 && timeDiff > -2 * 60 * 60 * 1000;

            const days = Math.max(0, Math.floor(timeDiff / (1000 * 60 * 60 * 24)));
            const hours = Math.max(0, Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)));
            const minutes = Math.max(0, Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60)));
            const seconds = Math.max(0, Math.floor((timeDiff % (1000 * 60)) / 1000));

            let countdownText = "";
            if (timeDiff > 0) {
                if (days > 0) countdownText += `${days}d `;
                countdownText += `${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
            } else if (timeDiff > -2 * 60 * 60 * 1000) {
                countdownText = "¡EN VIVO!";
            } else {
                countdownText = "Finalizado";
            }

            return { canJoin, countdownText };
        }

        function tick() {
            updateState({ now: new Date() });
            const countdownEl = document.getElementById('countdown');
            if (countdownEl) {
                countdownEl.textContent = calculateCountdown().countdownText;
            }
        }

        // --- Utilidad ---
        function isValidEmail(email) {
            return typeof email === "string" && email.includes("@") && email.includes(".") && email.length > 5;
        }

        function closeAllModals() {
            updateState({
                openGuide: false,
                openRSVP: false,
                joinModalOpen: false,
                messageModal: null
            });
        }

        // --- Actions ---
        function handleJoinClick(e) {
            const { canJoin } = calculateCountdown();
            if (!canJoin) {
                updateState({ joinModalOpen: true });
            } else {
                window.open(MEET_URL, "_blank", "noopener,noreferrer");
            }
        }

        async function submitRsvp(e) {
            e.preventDefault();
            updateState({ lastError: null, rsvpServerResponse: null });

            const name = state.rsvpName.trim();
            const email = state.rsvpEmail.trim();

            if (!name) {
                updateState({ messageModal: { title: "Falta Nombre", message: "Por favor ingresa tu nombre completo.", type: "error" } });
                return;
            }
            if (!isValidEmail(email)) {
                updateState({ messageModal: { title: "Correo Inválido", message: "Por favor ingresa un correo válido.", type: "error" } });
                return;
            }

            updateState({ sending: true });

            const payloadObj = {
                name: name,
                email: email,
                timestamp: new Date().toISOString(),
                source: "InvitacionWeb-ElRadarDelCielo",
            };

            try {
                if (SHEET_ENDPOINT && SHEET_ENDPOINT.startsWith('http')) {
                    const params = new URLSearchParams();
                    Object.keys(payloadObj).forEach((k) => params.append(k, payloadObj[k]));

                    const res = await fetch(SHEET_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: params.toString(),
                    });

                    const text = await res.text();
                    let json = null;
                    try { json = JSON.parse(text); } catch (err) { }

                    if (!res.ok) {
                        throw new Error(`Error ${res.status} - ${text}`);
                    }

                    updateState({
                        rsvpServerResponse: { ok: true, status: res.status, body: json || text },
                        rsvpSent: true,
                        rsvpName: "",
                        rsvpEmail: "",
                        messageModal: { title: "¡Inscripción Recibida!", message: "Tu asistencia ha sido confirmada.", type: "success" }
                    });
                    setTimeout(() => updateState({ openRSVP: false }), 2500);

                } else {
                    // Simulación
                    console.warn('Simulando envío:', payloadObj);
                    updateState({
                        rsvpServerResponse: { ok: true, simulated: true },
                        rsvpSent: true,
                        rsvpName: "",
                        rsvpEmail: "",
                        messageModal: { title: "¡Simulación Exitosa!", message: "Envío simulado correctamente.", type: "success" }
                    });
                    setTimeout(() => updateState({ openRSVP: false }), 2500);
                }
            } catch (err) {
                console.error('Error:', err);
                updateState({
                    lastError: err.message,
                    messageModal: { title: "Error", message: "No se pudo enviar la inscripción. Intenta de nuevo.", type: "error" }
                });
            } finally {
                updateState({ sending: false });
            }
        }

        // --- Render Functions ---

        function renderMessageModal() {
            if (!state.messageModal) return '';
            const { title, message, type } = state.messageModal;
            const bgColor = type === "error" ? "bg-rose-600" : "bg-emerald-600";

            return `
                <div class="fixed inset-0 z-[100] flex items-center justify-center p-4">
                    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="updateState({ messageModal: null })"></div>
                    <div class="relative w-full max-w-sm rounded-2xl p-6 shadow-2xl z-20 ${bgColor} text-white border border-white/10">
                        <h4 class="text-xl font-bold font-title mb-2">${title}</h4>
                        <p class="text-white/90 mb-6 font-light">${message}</p>
                        <div class="flex justify-end">
                            <button onclick="updateState({ messageModal: null })" class="px-5 py-2 rounded-xl bg-white text-slate-900 font-bold hover:bg-opacity-90 transition">
                                Aceptar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderJoinModal() {
            if (!state.joinModalOpen) return '';
            return `
                <div class="fixed inset-0 z-60 flex items-center justify-center p-4">
                    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="updateState({ joinModalOpen: false })"></div>
                    <div class="relative bg-slate-900 border border-slate-700 rounded-2xl p-8 shadow-2xl max-w-md w-full z-10 text-center">
                        <div class="w-16 h-16 rounded-full bg-cyan-500/10 flex items-center justify-center mx-auto mb-4 radar-effect">
                            <svg class="w-8 h-8 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h4 class="text-2xl font-bold text-white font-title mb-2">¡Aún no es la hora!</h4>
                        <p class="text-slate-300 mb-6 leading-relaxed">
                            La transmisión comenzará **5 minutos antes** de las 3:00 p.m.<br>
                            ¡Prepárate para actuar!
                        </p>
                        <button onclick="updateState({ joinModalOpen: false })" class="px-6 py-3 rounded-xl bg-cyan-600 text-white font-bold hover:bg-cyan-500 transition w-full">Entendido</button>
                    </div>
                </div>
            `;
        }

        function renderGuideModal() {
            if (!state.openGuide) return '';
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="updateState({ openGuide: false })"></div>
                    <div class="relative w-full max-w-lg bg-slate-900 border border-slate-700 rounded-2xl p-8 shadow-2xl z-10">
                        <h3 class="text-2xl font-bold text-white font-title mb-4">Hoja de Ruta</h3>
                        <p class="text-slate-300 mb-6">Accede a la guía completa para preparar tu corazón y mente para el mensaje.</p>
                        <a href="${GUIDE_URL}" target="_blank" onclick="updateState({ openGuide: false })"
                            class="block w-full py-4 rounded-xl bg-gradient-to-r from-cyan-600 to-blue-600 text-white text-center font-bold hover:from-cyan-500 hover:to-blue-500 transition shadow-lg shadow-cyan-900/20">
                            Descargar Documento
                        </a>
                        <button onclick="updateState({ openGuide: false })" class="mt-4 w-full py-2 text-slate-400 hover:text-white transition">Cerrar</button>
                    </div>
                </div>
            `;
        }

        function renderRSVPModal() {
            if (!state.openRSVP) return '';
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="updateState({ openRSVP: false })"></div>
                    <form onsubmit="submitRsvp(event)" class="relative w-full max-w-sm bg-slate-900 border border-slate-700 rounded-2xl p-8 shadow-2xl z-10">
                        <h3 class="text-xl font-bold text-white font-title mb-1">Confirmar Asistencia</h3>
                        <p class="text-sm text-cyan-400 mb-6">La fe que se arremanga</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs uppercase text-slate-400 font-bold mb-1">Nombre</label>
                                <input id="rsvpName" required type="text" value="${state.rsvpName}" oninput="state.rsvpName = this.value"
                                    class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white focus:border-cyan-500 focus:outline-none transition" placeholder="Tu nombre">
                            </div>
                            <div>
                                <label class="block text-xs uppercase text-slate-400 font-bold mb-1">Correo</label>
                                <input id="rsvpEmail" required type="email" value="${state.rsvpEmail}" oninput="state.rsvpEmail = this.value"
                                    class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white focus:border-cyan-500 focus:outline-none transition" placeholder="tucorreo@email.com">
                            </div>
                        </div>

                        <div class="mt-8 flex gap-3">
                            <button type="submit" ${state.sending ? 'disabled' : ''} class="flex-1 py-3 rounded-lg bg-cyan-600 text-white font-bold hover:bg-cyan-500 transition disabled:opacity-50 flex justify-center items-center gap-2">
                                ${state.sending ? '<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>' : ''}
                                <span>${state.sending ? 'Enviando...' : 'Confirmar'}</span>
                            </button>
                            <button type="button" onclick="updateState({ openRSVP: false })" class="px-4 py-3 rounded-lg border border-slate-600 text-slate-300 font-bold hover:bg-slate-800 transition">Cancelar</button>
                        </div>
                    </form>
                </div>
            `;
        }

        // --- Main Render ---
        function render() {
            const app = document.getElementById('app');
            if (!app) return;

            // Preserve Focus Logic (Simplified)
            let focusedId = document.activeElement ? document.activeElement.id : null;
            let focusedVal = document.activeElement ? document.activeElement.value : null;

            const { openCover } = state;
            const { canJoin, countdownText } = calculateCountdown();

            let mainContent = '';

            if (!openCover) {
                // COVER
                mainContent = `
                    <div class="text-center p-8 max-w-sm w-full animate-fade-in-up">
                        <div class="relative w-32 h-32 mx-auto mb-8 rounded-full p-1 bg-gradient-to-tr from-cyan-400 to-yellow-400 radar-effect">
                            <img src="https://i.imgur.com/2MVPpVr.png" class="w-full h-full object-cover rounded-full border-4 border-slate-900" alt="Radar Icon">
                        </div>
                        <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 via-white to-yellow-200 mb-2 tracking-tight drop-shadow-lg">
                            La fe que<br>se arremanga
                        </h1>
                        <p class="text-lg text-cyan-200/80 tracking-widest uppercase font-light mb-8 font-title">Menos palabras mas acción</p>

                        <button onclick="updateState({ openCover: true })"
                            class="group relative px-8 py-3 bg-slate-800 overflow-hidden rounded-full transition-all hover:scale-105 hover:shadow-[0_0_20px_rgba(34,211,238,0.4)] border border-cyan-500/30">
                            <div class="absolute inset-0 w-0 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 transition-all duration-[250ms] ease-out group-hover:w-full"></div>
                            <span class="relative text-cyan-300 font-bold tracking-wider group-hover:text-white transition-colors">MANOS A LA OBRA</span>
                        </button>
                    </div>
                `;
            } else {
                // INVITATION CARD
                mainContent = `
                    <div class="w-full max-w-4xl animate-fade-in transition-all duration-700">
                        <div class="glass-panel rounded-3xl overflow-hidden shadow-2xl relative">
                            <!-- Background Decoration -->
                            <div class="absolute -top-24 -right-24 w-64 h-64 bg-cyan-500/20 rounded-full blur-3xl"></div>
                            <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-blue-600/20 rounded-full blur-3xl"></div>

                            <div class="grid grid-cols-1 md:grid-cols-2 relative z-10">
                                <!-- Left Column: Visual -->
                                <div class="p-8 md:p-12 flex flex-col justify-center items-center text-center md:border-r border-white/10 bg-black/20">
                                    <div class="relative mb-6 group cursor-pointer hover:scale-[1.02] transition-transform duration-500">
                                        <div class="absolute -inset-1 bg-gradient-to-r from-cyan-400 to-blue-600 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-500"></div>
                                        <img src="https://i.imgur.com/2MVPpVr.png" alt="El Radar del Cielo" 
                                            class="relative w-full max-w-[280px] rounded-xl shadow-2xl border border-white/10">
                                    </div>
                                    <h2 class="text-3xl font-bold text-white font-title mb-2">La fe que se arremanga</h2>
                                    <p class="text-cyan-200 text-sm tracking-widest uppercase">Menos palabras mas acción</p>
                                </div>

                                <!-- Right Column: Info & Actions -->
                                <div class="p-8 md:p-12 flex flex-col justify-between">
                                    <div class="space-y-6">
                                        <div>
                                            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/20 mb-3">
                                                <span class="w-2 h-2 rounded-full bg-cyan-400 animate-pulse"></span>
                                                <span class="text-xs font-bold text-cyan-300 uppercase tracking-wider">Transmisión en Vivo</span>
                                            </div>
                                            <h3 class="text-4xl font-bold text-white font-title mb-1">2 Enero 2026</h3>
                                            <p class="text-lg text-slate-300">Viernes • 3:00 P.M.</p>
                                        </div>

                                        <div class="p-4 rounded-xl bg-slate-800/50 border border-slate-700/50">
                                            <p class="text-xs uppercase text-slate-500 font-bold mb-1">Tiempo Restante</p>
                                            <p id="countdown" class="text-2xl font-mono text-white font-bold tracking-tight">${countdownText}</p>
                                        </div>
                                        
                                        <div class="text-sm text-slate-300 leading-relaxed border-l-2 border-cyan-500/30 pl-4">
                                            <p>No basta con creer, hay que actuar. Únete a nosotros para poner la fe en movimiento y trabajar por lo que visionamos. <span class="text-cyan-200 font-bold">Es hora de arremangarse.</span></p>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
                                        <button onclick="handleJoinClick(event)" 
                                            class="col-span-1 sm:col-span-2 py-3 rounded-xl font-bold shadow-lg transition-all transform hover:scale-[1.02] active:scale-95 flex justify-center items-center gap-2
                                            ${canJoin ? 'bg-gradient-to-r from-cyan-500 to-blue-600 text-white hover:shadow-cyan-500/25' : 'bg-slate-800 border border-slate-700 text-slate-400'}">
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/></svg>
                                            <span>Ir a la Acción</span>
                                        </button>
                                        
                                        <button onclick="updateState({ openGuide: true })" class="py-3 rounded-xl border border-slate-600 bg-transparent text-slate-200 font-semibold hover:bg-slate-800 transition">
                                            Abrir Guía
                                        </button>
                                        
                                        <button onclick="updateState({ openRSVP: true })" class="py-3 rounded-xl bg-slate-700 text-white font-semibold hover:bg-slate-600 transition">
                                            Confirmar Asistencia
                                        </button>
                                    </div>
                                    
                                    <div class="mt-8 pt-4 border-t border-white/5 text-center">
                                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">La Casa de Juanita · Fe con Propósito</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            app.innerHTML = `
                <main class="min-h-screen bg-[#050B14] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#050B14] to-[#020617] flex items-center justify-center p-4 selection:bg-cyan-500/30">
                    ${mainContent}
                </main>
                ${renderJoinModal()}
                ${renderGuideModal()}
                ${renderRSVPModal()}
                ${renderMessageModal()}
            `;

            // Restore focus (basic)
            if (focusedId) {
                const el = document.getElementById(focusedId);
                if (el) {
                    el.value = focusedVal;
                    el.focus();
                }
            }
        }

        window.onload = function () {
            setInterval(tick, 1000);
            tick();
            window.addEventListener("keydown", (e) => {
                if (e.key === "Escape") { closeAllModals(); if (state.openCover) updateState({ openCover: false }); }
            });
            render();
        };
    </script>
</head>

<body class="bg-[#050B14] text-slate-200 antialiased">
    <div id="app"></div>
</body>

</html>
